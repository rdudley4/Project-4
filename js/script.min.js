var currentSrc,videoId,videoTitle,currentVideo,player,controlBarExtended=true,videoCount=0,$lightbox=$("#lightbox"),$lbImage=$(".selected"),$controls=$("#controls"),$mainSearch=$("#main-search"),$toggle=$("#toggle"),$songBar=$("#song-container"),lightboxIsActive=false,prevClicked=false,nextClicked=false,recentlyPlayed=[];var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);function onYouTubeIframeAPIReady(){for(var i=0;i<galleryDB.length;i++){if(galleryDB[i].type==="yt"){player=new YT.Player("item"+galleryDB[i].id,{videoId:galleryDB[i].videoID,events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}});videoCount++}}var pauseButton=document.getElementById("pause");pauseButton.addEventListener("click",function(){currentVideo.pauseVideo()});var playButton=document.getElementById("play");playButton.addEventListener("click",function(){currentVideo.playVideo()});var playButton=document.getElementById("replay");playButton.addEventListener("click",function(){currentVideo.seekTo(0)})}function updatePlayerReference(e){currentVideo=e.target;videoTitle=currentVideo.getVideoData().title;videoId=currentVideo.getVideoData().video_id}function onPlayerReady(event){updatePlayerReference(event);for(var i=0;i<galleryDB.length;i++){if(galleryDB[i].videoID===videoId){galleryDB[i].caption=videoTitle}}}function onPlayerStateChange(event){var showPauseButton=[{e:$("#play"),p:{opacity:0},o:{duration:100,visibility:"hidden"}},{e:$("#pause"),p:{opacity:1},o:{duration:100,visibility:"visible"}}],showPlayButton=[{e:$("#pause"),p:{opacity:0},o:{duration:100,visibility:"hidden"}},{e:$("#play"),p:{opacity:1},o:{duration:100,visibility:"visible"}}];if(event.data==YT.PlayerState.PLAYING){updatePlayerReference(event);$("#currentThumbnail").attr("src","https://img.youtube.com/vi/"+videoId+"/mqdefault.jpg");$("#currentSong").text(videoTitle);$.Velocity.RunSequence(showPauseButton);recentlyPlayed.unshift(currentVideo);if(recentlyPlayed.length>2){recentlyPlayed.pop()}}else if(currentVideo!=null){if(currentVideo.getPlayerState()===2||currentVideo.getPlayerState()===0){$.Velocity.RunSequence(showPlayButton)}}if(recentlyPlayed.length===2){if(recentlyPlayed[0].getPlayerState()===1&&recentlyPlayed[1].getPlayerState()===1&&recentlyPlayed[0].getVideoData().video_id!=recentlyPlayed[1].getVideoData().video_id){recentlyPlayed[1].pauseVideo()}}}$toggle.on("click",function(){var showContolBar=[{e:$songBar,p:{height:48,bottom:0},o:{duration:350}},{e:$songBar.children("span"),p:{opacity:1},o:{duration:350,display:"block",sequenceQueue:false}},{e:$("#replay"),p:{opacity:1},o:{duration:100,display:"block",sequenceQueue:false}},{e:$toggle,p:{rotateZ:0,scaleX:1,scaleY:1,top:0},o:{duration:100,sequenceQueue:false}}],hideControlBar=[{e:$songBar,p:{height:0,bottom:-3},o:{duration:150}},{e:$songBar.children("span"),p:{opacity:0},o:{duration:150,display:"none",sequenceQueue:false}},{e:$("#replay"),p:{opacity:0},o:{duration:100,display:"none",sequenceQueue:false}},{e:$toggle,p:{rotateZ:180,scaleX:2,scaleY:2,top:-40},o:{duration:100,sequenceQueue:false}}];if(controlBarExtended){$.Velocity.RunSequence(hideControlBar);$("#toggle").addClass("showbar");controlBarExtended=false}else{$.Velocity.RunSequence(showContolBar);$("#toggle").removeClass("showbar");controlBarExtended=true}});function assembleImage(imageObject){var $galleryItem=$('<div class="gallery-item"></div>');if(imageObject.type==="img"){var $top=$('<div class="layer-top"></div>'),$bottom=$('<div class="layer-bottom"></div>'),$thumbnail=$('<img src="'+imageObject.thumbnail+'">'),$link=$('<a href="'+imageObject.src+'"></a>'),$details=$('<div class="details"></div>'),$title=$('<span class="title"></span>'),$icon=$('<i class="fa fa-expand fa-3x" aria-hidden="true"></i>'),$resolution=$('<span class="resolution">'+imageObject.resolution+"</span>"),$id=$('<span class="image-id">ID - '+imageObject.id+"</span>");$top.append($thumbnail);$title.append(imageObject.caption);$details.append($icon,$title,$resolution,$id);$link.append($details);$bottom.append($link);$galleryItem.append($top,$bottom)}else if(imageObject.type==="yt"){console.log("Video stuff fired.")}$galleryItem.attr("id","item"+imageObject.id);$("#gallery").append($galleryItem)}function nextImage(){for(i=0;i<galleryDB.length;i++){var firstImage=galleryDB[0].src,lastImage=galleryDB[galleryDB.length-(videoCount+1)].src;if(prevClicked&&currentSrc===galleryDB[i].src){if(currentSrc===firstImage){currentSrc=lastImage;console.log("First image detected, going to end of series.");return currentSrc}else{currentSrc=galleryDB[i-1].src;return currentSrc}}else if(nextClicked&&currentSrc===galleryDB[i].src){if(currentSrc===lastImage){currentSrc=firstImage;console.log("Last image detected, going to start of series.");return currentSrc}else{currentSrc=galleryDB[i+1].src;return currentSrc}}}}function updateImage(){currentSrc=nextImage();$lbImage.velocity({opacity:0},150,function(){$lbImage.velocity({opacity:1},150).attr("src",currentSrc)})}function updateDescription(){for(i=0;i<galleryDB.length;i++){if(currentSrc===galleryDB[i].src){$(".image-description").text(galleryDB[i].caption)}}}function filterResults(index){var galleryItem=$("#item"+(index+1));if(galleryDB[index].isMatched){galleryItem.velocity({bottom:0},{duration:250,display:"inline-block"})}else{galleryItem.velocity({bottom:-204},{duration:250,display:"none"})}}function resetFilter(){for(var i=0;i<galleryDB.length;i++){galleryDB[i].isMatched=true;filterResults(i)}}$(document).ready(function(){$("body").append($lightbox);for(var i=0;i<galleryDB.length;i++){galleryDB[i].id=i+1;assembleImage(galleryDB[i])}$mainSearch.on("keyup",function(){var userInput=$mainSearch.val().toLowerCase(),results=0;if(userInput.length>0){for(var i=0;i<galleryDB.length;i++){if(galleryDB[i].caption.toLowerCase().indexOf(userInput)!==-1||parseInt(userInput)===galleryDB[i].id||galleryDB[i].type===userInput){results++;galleryDB[i].isMatched=true}else{galleryDB[i].isMatched=false}filterResults(i)}if(results===0){$("#results").text("No results found.")}else if(results===1){if($("#results").css("visibility")==="hidden"){$("#results").velocity({opacity:1},{visibility:"visible",duration:250})}$("#results").text("Is this what you were looking for?")}else{$("#results").text(results+" results found.").velocity({opacity:1},{visibility:"visible",duration:250})}}else{resetFilter();results=0;$("#results").velocity({opacity:0},{visibility:"hidden",duration:250});console.log("Search filter has been reset.")}});$(".layer-bottom a").on("click",function(event){event.preventDefault();currentSrc=$(this).attr("href");$lbImage.attr("src",currentSrc);updateDescription();lightboxIsActive=true;$lightbox.velocity({opacity:1},{duration:75,display:"block"});console.log("Lightbox Activated")});$controls.children("#prev").on("click",function(){prevClicked=true;nextClicked=false;updateImage();updateDescription();console.log("Moving to previous image in series: "+currentSrc)});$controls.children("#next").on("click",function(){prevClicked=false;nextClicked=true;updateImage();updateDescription();console.log("Moving to next image in series: "+currentSrc)});$controls.children("#download").on("click",function(){console.log("Download trigger has fired.")});$controls.children("#close").on("click",function(){$lightbox.velocity({opacity:0},{duration:75,display:"none"});lightboxIsActive=false;console.log("Lightbox Closed")});$("#help").on("click",function(){if($("#hotkey-info").css("visibility")==="visible"){$("#hotkey-info").velocity({marginTop:-53},{duration:350,visibility:"hidden"})}else{$("#hotkey-info").velocity({marginTop:4},{duration:350,visibility:"visible"})}});$(document).keyup(function(e){var keyPressed=e.which;if(lightboxIsActive){switch(keyPressed){case 27:$lightbox.velocity({opacity:0},{duration:75,display:"none"});lightboxIsActive=false;console.log("Lightbox Closed.");break;case 37:$controls.children("#prev").trigger("click");break;case 39:$controls.children("#next").trigger("click");break;case 73:$("#help").trigger("click");break}}else{switch(keyPressed){case 192:$toggle.trigger("click");break}}})});